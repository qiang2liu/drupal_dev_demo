<?php

function themuraly_menu() {
  $items['muraltest'] = array(
      'page callback' => 'muralapi_test',
      'access callback' => TRUE,
      'type' => MENU_CALLBACK,
  );
  return $items;
}

function muralapi_test() {

  _test_mural_list_for_a_user();
  //_test_user_add();
  
  //_test_mural_create_mural();
  
  _test_mural_duplicate_mural();
  
  _test_mural_list_for_a_user();
  return "ok111";
}


function _test_mural_duplicate_mural() {
  $mural_api = new Muralapi;
  $params = array('title'=>'this is a duplicate from a mural','room'=> 1373060830214,);
  $result = $mural_api->duplicate_mural('testuser', '1373655313624' ,$params);
  $data = $result->data;
  $r = drupal_json_decode($data);
  dpm($result);
  dpm($r);
}

function _test_mural_create_mural() {
  $mural_api = new Muralapi;
  $params = array('title'=>'this is a mural','room'=> 1373060830214,);
  $result = $mural_api->create_mural('testuser', $params);
  $data = $result->data;
  $r = drupal_json_decode($data);
  dpm($result);
  dpm($r);
}

function _test_mural_list_for_a_user() {
  $mural_api = new Muralapi;
  $result = $mural_api->get_all_murals('testuser');
  $data = $result->data;
  $r = drupal_json_decode($data);
  dpm($result);
  dpm($r);
}

function _test_user_add() {

  $mural_api = new Muralapi;

  $user = array();
  $user['username'] = "test777";
  $user['email'] = "test778@symbio.com";
  $user['source'] = "edgemakers";
  $user['nameIdentifier'] = 3;

  $mural_api_result = $mural_api->create_user($user, '/api/organizations/edgemakers/users', 'POST');
  dpm($mural_api_result);
  //dd($mural_api_result);
  $muralapi_response_obj = drupal_json_decode($mural_api_result->data);
  dpm($muralapi_response_obj);

  if (isset($muralapi_response_obj['hasErrors'])) {
    if (!$muralapi_response_obj['hasErrors']) {
      // successful, then 
      $edit = array();
      // the $muralapi_response_obj will contain the user attribute ($muralapi_response_obj->user)
      // but now ,it has no this attribute, so , just reguard the $account->name as the  mural username
      $the_mural_username = "";
      if (isset($muralapi_response_obj['user'])) {
        if (isset($muralapi_response_obj['user']['username'])) {
          $the_mural_username = $muralapi_response_obj['user']['username'];
        }
      }


      $edit['field_muralusername'][LANGUAGE_NONE][0]['value'] = $the_mural_username;
      // user_save($account, $edit);
      dpm($edit);
    }
  }
}
